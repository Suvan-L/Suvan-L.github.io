<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.css.network/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="MyProject," />





  <link rel="alternate" href="/atom.xml" title="Suvan" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="前言&amp;emsp;学习使用WebMagic框架2016-12-2：刚接触，挺好的用的模块区分好，可个性化定制，不过还是有点不熟悉，时间慢慢沉淀，加油加油   学习Q群：373225642【webmagic探讨】 中文官方文档   大牛们的博客资料：  Java爬虫框架WebMagic的使用总结    一.环境 jdk版本：1.8.0_06 IDE:eclipse,Navicat for MySQL">
<meta name="keywords" content="MyProject">
<meta property="og:type" content="article">
<meta property="og:title" content="WebMagic爬虫">
<meta property="og:url" content="http://suvan-l.github.io/2016/12/05/MyProject_WebMagic爬虫/index.html">
<meta property="og:site_name" content="Suvan">
<meta property="og:description" content="前言&amp;emsp;学习使用WebMagic框架2016-12-2：刚接触，挺好的用的模块区分好，可个性化定制，不过还是有点不熟悉，时间慢慢沉淀，加油加油   学习Q群：373225642【webmagic探讨】 中文官方文档   大牛们的博客资料：  Java爬虫框架WebMagic的使用总结    一.环境 jdk版本：1.8.0_06 IDE:eclipse,Navicat for MySQL">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-12-05T03:15:22.912Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WebMagic爬虫">
<meta name="twitter:description" content="前言&amp;emsp;学习使用WebMagic框架2016-12-2：刚接触，挺好的用的模块区分好，可个性化定制，不过还是有点不熟悉，时间慢慢沉淀，加油加油   学习Q群：373225642【webmagic探讨】 中文官方文档   大牛们的博客资料：  Java爬虫框架WebMagic的使用总结    一.环境 jdk版本：1.8.0_06 IDE:eclipse,Navicat for MySQL">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://suvan-l.github.io/2016/12/05/MyProject_WebMagic爬虫/"/>





  <title>WebMagic爬虫 | Suvan</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Suvan</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Bolgs</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://suvan-l.github.io/2016/12/05/MyProject_WebMagic爬虫/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="liushuwei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/suvan.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Suvan">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">WebMagic爬虫</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-05T10:33:26+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MyProject/" itemprop="url" rel="index">
                    <span itemprop="name">MyProject</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计</span>
                
                <span title="字数统计">
                  4,579
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长</span>
                
                <span title="阅读时长">
                  23
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>&emsp;学习使用WebMagic框架<br>2016-12-2：刚接触，挺好的用的模块区分好，可个性化定制，不过还是有点不熟悉，时间慢慢沉淀，加油加油</p>
<p><br><br></p>
<ul>
<li>学习Q群：373225642【webmagic探讨】</li>
<li><a href="http://webmagic.io/docs/zh/" target="_blank" rel="external">中文官方文档</a></li>
</ul>
<p><br><br></p>
<p>大牛们的博客资料：</p>
<ul>
<li><a href="http://blog.csdn.net/jibaole/article/details/52212886" target="_blank" rel="external">Java爬虫框架WebMagic的使用总结</a></li>
</ul>
<hr>
<p><br><br><br><br><br></p>
<h1 id="一-环境"><a href="#一-环境" class="headerlink" title="一.环境"></a>一.环境</h1><ul>
<li>jdk版本：1.8.0_06</li>
<li>IDE:eclipse,Navicat for MySQL</li>
<li>数据库：MySQL57</li>
<li>框架技术：WebMagc</li>
<li>第三方扩展jar包:<a href="http://webmagic.io/" target="_blank" rel="external">WebMagic下载页面</a>，里的所有依赖jar包</li>
</ul>
<hr>
<p><br><br><br><br><br></p>
<h1 id="二-项目结构"><a href="#二-项目结构" class="headerlink" title="二.项目结构"></a>二.项目结构</h1><p>Webmagic<br>&emsp;src<br>&emsp;&emsp;bean<br>&emsp;&emsp;&emsp;……<br>&emsp;&emsp;Downloader<br>&emsp;&emsp;PageProcessor<br>&emsp;&emsp;&emsp;……<br>&emsp;&emsp;Pipeline<br>&emsp;&emsp;&emsp;……<br>&emsp;&emsp;Scheduler<br>&emsp;&emsp;Utils<br>&emsp;&emsp;&emsp;IOFile.java<br>&emsp;&emsp;&emsp;test.java<br>&emsp;&emsp;&emsp;UseDB.java<br>&emsp;&emsp;&emsp;UseString<br>&emsp;JRE System Library[Java SE-1.8]<br>&emsp;webmagic-lib【Build Path之后的类库】<br>&emsp;webmagic-lib【目录，存放下载的Jar包】</p>
<hr>
<p><br><br><br><br><br></p>
<h1 id="三-代码："><a href="#三-代码：" class="headerlink" title="三.代码："></a>三.代码：</h1><p><br><br></p>
<h2 id="1-爬取CSDN的博客【1-0版本】"><a href="#1-爬取CSDN的博客【1-0版本】" class="headerlink" title="1.爬取CSDN的博客【1.0版本】"></a>1.爬取CSDN的博客【1.0版本】</h2><p>&emsp;耗时1天半左右，边实践边学习，活性动态爬虫<br>&emsp;官网入口，爬取匹配正则的链接，然后爬取个人博客列表【所有页】,爬取个人资料页【好友….】<br><br><br></p>
<p>思路</p>
<ol>
<li>分析<a href="http://blog.csdn.net/和http://blog.csdn.net/lfdfhl和http://my.csdn.net/lfdfhl" target="_blank" rel="external">http://blog.csdn.net/和http://blog.csdn.net/lfdfhl和http://my.csdn.net/lfdfhl</a></li>
<li>编写PageProcessor，处理抓取数据也业务逻辑</li>
<li>编写Pipeline,将获得的数据经过处理，存入数据库</li>
</ol>
<p><br><br></p>
<p>遇到错误与困惑：</p>
<ol>
<li>使用PreparedStatement进入存入数据的时候，数据库内容全为?【utf8格式】</li>
<li>如何判断已经爬取过的URL，避免二次爬取？</li>
<li>List去重,框架的爬取队列是否有自动去重【可能是我的错觉，我都是手动list去重的】</li>
<li>灵活运用page.setSkip(true);.使页面进行过滤，不执行Pipeline</li>
<li>数据库对象如何重复利用，而不是每次都创建新的？</li>
<li>效率问题，自己还是不善于做数据分析</li>
</ol>
<p><br><br></p>
<p>效果：</p>
<ol>
<li>javareptile数据库,10006条记录【user_csdn】[13312KB],773347条记录【blog_csdn】[270336 KB]</li>
<li>耗时下午14.14开始，大约到19.00【吃晚饭回来就爬完了,有些人没有关注人，所以只爬到1W多个用户】</li>
</ol>
<p><br><br></p>
<p>A.设计数据库表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">1.用户个人资料表</div><div class="line">    自增id【主键】</div><div class="line">    博主【唯一】</div><div class="line">    个性签名</div><div class="line">    博文属性【原创,转载...】</div><div class="line">    博文类型【Android,java....】</div><div class="line">    访问次数【人气】</div><div class="line">    CSDN官博排名</div><div class="line"></div><div class="line">CREATE TABLE user_csdn(             </div><div class="line">    id INT auto_increment primary key,</div><div class="line">    blogger VARCHAR(50) NOT NULL unique,</div><div class="line">    signature VARCHAR(150),</div><div class="line">    articlenature VARCHAR(50),</div><div class="line">    articletype VARCHAR(2000),</div><div class="line">    visitcount VARCHAR(15),</div><div class="line">    ranking VARCHAR(10)</div><div class="line">)ENGINE = innoDB;</div><div class="line"></div><div class="line">***********************</div><div class="line"></div><div class="line">2.用户博文信息</div><div class="line">    编号自增【主键】</div><div class="line">    标题</div><div class="line">    URL【唯一】</div><div class="line">    阅读数</div><div class="line">    发表时间</div><div class="line">    博主</div><div class="line">CREATE TABLE blog_csdn(             </div><div class="line">    num INT auto_increment primary key,</div><div class="line">    title VARCHAR(100) NOT NULL,</div><div class="line">    URL VARCHAR(150) NOT NULL unique,</div><div class="line">    readCount VARCHAR(20) ,</div><div class="line">    time VARCHAR(20) NOT NULL,</div><div class="line">    blogger VARCHAR(50) NOT NULL</div><div class="line">)ENGINE = innoDB;</div></pre></td></tr></table></figure></p>
<hr>
<p>B.bean<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">package bean;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">public class CSDNBean &#123;</div><div class="line">    private String blogger;          //博主</div><div class="line">    private String signature;            //个性签名</div><div class="line">    private String ArticleNature;    //文章属性</div><div class="line">    private String ArticleType;          //文章分类</div><div class="line">    private String visitCount;           //访问次数</div><div class="line">    private String ranking;             //排名</div><div class="line">    </div><div class="line">    private List&lt;Object&gt; blog;      //博客信息</div><div class="line">    </div><div class="line"></div><div class="line">    public String getBlogger() &#123;</div><div class="line">        return blogger;</div><div class="line">    &#125;</div><div class="line">    public String getSignature() &#123;</div><div class="line">        return signature;</div><div class="line">    &#125;</div><div class="line">    public String getVisitCount() &#123;</div><div class="line">        return visitCount;</div><div class="line">    &#125;</div><div class="line">    public String getRanking() &#123;</div><div class="line">        return ranking;</div><div class="line">    &#125;</div><div class="line">    public String getArticleNature() &#123;</div><div class="line">        return ArticleNature;</div><div class="line">    &#125;</div><div class="line">    public String getArticleType() &#123;</div><div class="line">        return ArticleType;</div><div class="line">    &#125;</div><div class="line">    public List&lt;Object&gt; getBlog() &#123;</div><div class="line">        return blog;</div><div class="line">    &#125;</div><div class="line">    public void setBlogger(String blogger) &#123;</div><div class="line">        this.blogger = blogger;</div><div class="line">    &#125;</div><div class="line">    public void setSignature(String signature) &#123;</div><div class="line">        this.signature = signature;</div><div class="line">    &#125;</div><div class="line">    public void setVisitCount(String visitCount) &#123;</div><div class="line">        this.visitCount = visitCount;</div><div class="line">    &#125;</div><div class="line">    public void setRanking(String ranking) &#123;</div><div class="line">        this.ranking = ranking;</div><div class="line">    &#125;</div><div class="line">    public void setArticleNature(String articleNature) &#123;</div><div class="line">        ArticleNature = articleNature;</div><div class="line">    &#125;</div><div class="line">    public void setArticleType(String articleType) &#123;</div><div class="line">        ArticleType = articleType;</div><div class="line">    &#125;</div><div class="line">    public void setBlog(List&lt;Object&gt; blog) &#123;</div><div class="line">        this.blog = blog;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>C.PageProcessor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div></pre></td><td class="code"><pre><div class="line">package PageProcessor;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import Pipeline.CSDN_Pipeline;</div><div class="line">import bean.CSDNBean;</div><div class="line">import us.codecraft.webmagic.Page;</div><div class="line">import us.codecraft.webmagic.Site;</div><div class="line">import us.codecraft.webmagic.Spider;</div><div class="line">import us.codecraft.webmagic.processor.PageProcessor;</div><div class="line">import us.codecraft.webmagic.scheduler.QueueScheduler;</div><div class="line">import us.codecraft.webmagic.scheduler.component.BloomFilterDuplicateRemover;</div><div class="line"></div><div class="line">public class CSDN_Processor implements PageProcessor&#123;</div><div class="line"></div><div class="line">    //个人博文列表页</div><div class="line">    private static final String blog_LIST=&quot;http://blog.csdn.net/\\w+/&quot;; </div><div class="line">    //个人资料页面</div><div class="line">    private static final String blog_SPACELIST=&quot;http://my.csdn.net/\\w+&quot;;</div><div class="line">    </div><div class="line">    private int count=0;//统计爬虫爬取次数</div><div class="line">    private long beginTime=System.currentTimeMillis();//统计开始爬取的时间</div><div class="line">    </div><div class="line">    </div><div class="line">    private Site site = Site.me().setCharset(&quot;utf-8&quot;).setRetryTimes(1).setSleepTime(1);</div><div class="line"></div><div class="line">    public Site getSite() &#123;</div><div class="line">        return site;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    public void process(Page page)&#123;</div><div class="line">        System.out.println(&quot;************************第&quot;+(++count)+&quot;次*************已花费&quot;+String.valueOf(((double)System.currentTimeMillis()-beginTime)/1000)+&quot;秒*************************&quot;);</div><div class="line">        System.out.println(&quot;***********************正在爬取&quot;+page.getUrl().get()+&quot;......&quot;);</div><div class="line">        //第一步:爬取入口页面,能够匹配正则的链接【个人博文页面】</div><div class="line">        List&lt;String&gt; blog_list=page.getHtml().links().regex(blog_LIST).all();</div><div class="line">        if(blog_list.size()&gt;0)&#123;</div><div class="line">            for(int i=0;i&lt;blog_list.size();i++)&#123;    //List集合去重操作</div><div class="line">                for(int j=0;j&lt;blog_list.size();j++)&#123;</div><div class="line">                    if(blog_list.get(i).equals(blog_list.get(j)))&#123;</div><div class="line">                        blog_list.remove(j);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        page.addTargetRequests(blog_list);</div><div class="line">        List&lt;String&gt; blog_spacelist=page.getHtml().links().regex(blog_SPACELIST).all();</div><div class="line">        if(blog_spacelist.size()!=0)&#123;               //判断是否为空</div><div class="line">            for(int i=0;i&lt;blog_spacelist.size();i++)&#123;   //List集合去重操作</div><div class="line">                for(int j=0;j&lt;blog_spacelist.size();j++)&#123;</div><div class="line">                    if(blog_spacelist.get(i).equals(blog_spacelist.get(j)))&#123;</div><div class="line">                        blog_spacelist.remove(j);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">                page.addTargetRequests(blog_spacelist);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">        </div><div class="line">        //第二步：获取当前用户所有页面的博文标题和URL</div><div class="line">            if(page.getUrl().regex(blog_LIST).match())&#123;                                 //1.判定URL是否匹配正则</div><div class="line">                System.out.println(&quot;*************个人博文列表页面***************&quot;);</div><div class="line">                    //A-1.在第一页中该用户所有页面的URL,添加入待爬去的队列</div><div class="line">                    if(!page.getUrl().regex(&quot;(.*)/list/(.*)&quot;).match())&#123;                             //若URL中不存在/list/，则执行下列操作</div><div class="line">                        String pageS =page.getHtml().xpath(&quot;//div[@id=&apos;papelist&apos;]/span[1]/allText()&quot;).get(); //获取总页数</div><div class="line">                        int pageCount =Integer.parseInt(pageS.substring(pageS.indexOf(&quot;共&quot;)+1,pageS.lastIndexOf(&quot;页&quot;)));</div><div class="line">                        </div><div class="line">                        for(int p=2;p&lt;=pageCount;p++)&#123;      //生成URL【跳进来的时候就是第1页了，所以从第2页开始】</div><div class="line">                            page.addTargetRequest(page.getUrl()+&quot;article/list/&quot;+p);//将URL添加到爬取队列</div><div class="line">                        &#125;   </div><div class="line">                    &#125;</div><div class="line">                    </div><div class="line">                    //A-2.将用户列表添加进个人页面</div><div class="line">                    page.addTargetRequest(page.getUrl().get().replace(&quot;blog.csdn&quot;, &quot;my.csdn&quot;));</div><div class="line"></div><div class="line">                    </div><div class="line">                    //B.爬取个人资料，保存到Bean对象</div><div class="line">                    CSDNBean bean = new CSDNBean();</div><div class="line">                        bean.setBlogger(page.getHtml().xpath(&quot;//div[@id=&apos;blog_title&apos;]/h2/a/allText()&quot;).get());                      //【博主】</div><div class="line">                        bean.setSignature(page.getHtml().xpath(&quot;//div[@id=&apos;blog_title&apos;]/h3/allText()&quot;).get());                      //【个性签名】</div><div class="line">                        bean.setArticleNature(page.getHtml().xpath(&quot;//ul[@id=&apos;blog_statistics&apos;]/allText()&quot;).get());                 //【文章属性】</div><div class="line">                        bean.setArticleType(page.getHtml().xpath(&quot;//div[@id=&apos;panel_Category&apos;]/ul[2]/allText()&quot;).get());     //【文章类型】</div><div class="line">                        bean.setVisitCount(page.getHtml().xpath(&quot;//ul[@id=&apos;blog_rank&apos;]/li[1]/span[1]/allText()&quot;).get());        //【访问次数】</div><div class="line">                        bean.setRanking(page.getHtml().xpath(&quot;//ul[@id=&apos;blog_rank&apos;]/li[4]/span[1]/allText()&quot;).get());           //【排名】</div><div class="line">        </div><div class="line">        </div><div class="line">                    //C.爬取用户博文信息【n * (标题,URL,阅读次数,发表时间)】，按顺序添加到List</div><div class="line">                    List&lt;Object&gt; allList = new ArrayList&lt;Object&gt;();</div><div class="line">                        allList.add(page.getHtml().xpath(&quot;//div[@class=&apos;article_title&apos;]/h1/allText()&quot;).all());                      //title_list                【文章标题】</div><div class="line">                        allList.add(page.getHtml().xpath(&quot;//h1/span/a/@href&quot;).all());                                                       //URL_list              【内容URL】</div><div class="line">                        allList.add(page.getHtml().xpath(&quot;//div[@class=&apos;article_manage&apos;]/span[2]/allText()&quot;).all());        //readCount_list    【阅读次数】</div><div class="line">                        allList.add(page.getHtml().xpath(&quot;//div[@class=&apos;article_manage&apos;]/span[1]/allText()&quot;).all());        //time_list             【发表时间】</div><div class="line">                        bean.setBlog(allList);</div><div class="line">                    </div><div class="line">                    //C.传递数据，储存进数据库</div><div class="line">                        page.putField(&quot;CSDNBean&quot;, bean);    </div><div class="line">                        </div><div class="line">                &#125;else if(page.getUrl().regex(blog_SPACELIST).match())&#123;              </div><div class="line">                    System.out.println(&quot;*************进入到个人资料页面***************&quot;);//处理个人资料页面【主要获取其他用户的URL】</div><div class="line">                    page.setSkip(true);</div><div class="line">                    List&lt;String&gt; otherUser_list =page.getHtml().links().regex(blog_SPACELIST).all();</div><div class="line">                    for(int i=0;i&lt;otherUser_list.size();i++)&#123;   //List集合去重操作</div><div class="line">                        for(int j=0;j&lt;otherUser_list.size();j++)&#123;</div><div class="line">                            if(otherUser_list.get(i).equals(otherUser_list.get(j)))&#123;</div><div class="line">                                otherUser_list.remove(j);</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    for(int i=0;i&lt;otherUser_list.size();i++)&#123;</div><div class="line">                        System.out.println(&quot;成功爬取到用户-----&gt;&quot;+(otherUser_list.get(i).replace(&quot;my.csdn&quot;,&quot;blog.csdn&quot;)));</div><div class="line">                        page.addTargetRequest(otherUser_list.get(i).replace(&quot;my.csdn&quot;,&quot;blog.csdn&quot;));//将URL添加到爬取队列</div><div class="line">                    &#125;</div><div class="line">                &#125;else</div><div class="line">                    &#123;page.setSkip(true);&#125; //设置skip之后，这个页面的结果不会被Pipeline处理</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public static void main(String [] args)&#123;</div><div class="line">        try&#123;</div><div class="line">        Spider.create(new CSDN_Processor())</div><div class="line">            .addUrl(&quot;http://blog.csdn.net/&quot;)                                        //CSDN官网入口</div><div class="line">            .scheduler(new QueueScheduler().setDuplicateRemover(new BloomFilterDuplicateRemover(10000000))) //QueueScheduler【使用内存队列保存待抓取URL】，使用BloomFilterDuplicateRemove去重</div><div class="line">            .addPipeline(new CSDN_Pipeline())                                   //添加Pipeline,对数据进行处理每个Page如果skip为true，都会执行CSDN_Pipeline的process()</div><div class="line">            .thread(10)                                                                     //开启10个线程进爬取</div><div class="line">            .run();</div><div class="line">        &#125;catch(Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>D.Pipeline<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line">package Pipeline;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line">import java.util.Map;</div><div class="line"></div><div class="line">import Utils.UseDB;</div><div class="line">import bean.CSDNBean;</div><div class="line">import us.codecraft.webmagic.ResultItems;</div><div class="line">import us.codecraft.webmagic.Task;</div><div class="line">import us.codecraft.webmagic.pipeline.ConsolePipeline;</div><div class="line"></div><div class="line">public class CSDN_Pipeline extends ConsolePipeline  &#123;</div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">     // ResultItems保存了抽取结果，它是一个Map结构，</div><div class="line">    // 在page.putField(key,value)中保存的数据，可以通过ResultItems.get(key)获取</div><div class="line">    public void process(ResultItems resultItems, Task arg1) &#123;</div><div class="line">        </div><div class="line">        UseDB udb = new UseDB();</div><div class="line">        </div><div class="line">        try&#123;</div><div class="line">            udb.connDatabase(&quot;javareptile&quot;);</div><div class="line">        </div><div class="line">            //1.获取对象</div><div class="line">            CSDNBean bean =(CSDNBean)resultItems.get(&quot;CSDNBean&quot;);</div><div class="line">            if(bean!=null)&#123;</div><div class="line">                </div><div class="line">                //1.判断是否存在相同用户，若不存在则插入用户个人信息</div><div class="line">                String ifExit=udb.selectIfExist_CheckRecord(&quot;user_csdn&quot;, &quot;blogger&quot;,&quot;blogger=&apos;&quot;+bean.getBlogger()+&quot;&apos;&quot;);</div><div class="line">                if(ifExit==null)&#123;</div><div class="line">                    System.out.println(&quot;博主\t\t\t\t\t\t&quot;+&quot;个性签名\t\t\t\t\t\t&quot;+&quot;博文属性\t\t\t\t\t\t&quot;+&quot;博文类型\t\t\t\t\t\t&quot;+&quot;访问次数\t\t\t\t\t\t&quot;+&quot;排名\t\t\t\t\t\t&quot;);</div><div class="line">                    System.out.println(bean.getBlogger()+&quot;\t&quot;+bean.getSignature()+&quot;\t&quot;+bean.getArticleNature()+&quot;\t&quot;+bean.getArticleType()+&quot;\t&quot;+bean.getVisitCount()+&quot;\t&quot;+bean.getRanking());</div><div class="line">                    udb.insert(&quot;user_csdn&quot;, </div><div class="line">                                    &quot;blogger,signature,articlenature,articletype,visitcount,ranking&quot;, </div><div class="line">                                    &quot;&apos;&quot;+    bean.getBlogger()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                            bean.getSignature()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                            bean.getArticleNature()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                            bean.getArticleType()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                            bean.getVisitCount()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                            bean.getRanking()+&quot;&apos;&quot;);</div><div class="line">                &#125;</div><div class="line">                </div><div class="line">                //2.插入用户博文信息</div><div class="line">                List&lt;String&gt; title_list=(List)bean.getBlog().get(0);                //【文章标题】</div><div class="line">                List&lt;String&gt; URL_list=(List)bean.getBlog().get(1);              //【内容URL】</div><div class="line">                List&lt;String&gt; readCount_list=(List)bean.getBlog().get(2);        //【阅读次数】</div><div class="line">                List&lt;String&gt; time_list=(List)bean.getBlog().get(3);             //【发表时间】</div><div class="line">                System.out.println(&quot;标题\t\t\t\t\t\t\t&quot;+&quot;URL地址\t\t\t\t\t\t\t&quot;+&quot;阅读次数\t\t\t\t\t\t\t&quot;+&quot;发表时间\t\t\t\t\t\t\t&quot;+&quot;作者\t\t\t\t\t\t\t&quot;);</div><div class="line">                for(int i=0;i&lt;title_list.size();i++)&#123;</div><div class="line">                    System.out.println(title_list.get(i)+&quot;\t&quot;+ URL_list.get(i)+&quot;\t&quot;+ readCount_list.get(i).replace(&quot;阅读&quot;,&quot;&quot;)+&quot;\t&quot;+time_list.get(i)+&quot;\t&quot;+bean.getBlogger());</div><div class="line">                    String title=title_list.get(i).replace(&quot;,&quot;,&quot;，&quot;).replace(&quot;&apos;&quot;,&quot;‘&quot;);</div><div class="line">                    udb.insert(&quot;blog_csdn&quot;, </div><div class="line">                                    &quot;title,URL,readCount,time,blogger&quot;,</div><div class="line">                                    &quot;&apos;&quot;+title+&quot;&apos;,&apos;&quot;+</div><div class="line">                                          URL_list.get(i)+&quot;&apos;,&apos;&quot;+</div><div class="line">                                          readCount_list.get(i).replace(&quot;阅读&quot;,&quot;&quot;)+&quot;&apos;,&apos;&quot;+</div><div class="line">                                          time_list.get(i)+&quot;&apos;,&apos;&quot;+</div><div class="line">                                          bean.getBlogger()+&quot;&apos;&quot;);</div><div class="line">                &#125;</div><div class="line">            </div><div class="line">                </div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            //第三步：关闭数据库连接</div><div class="line">            udb.closeAll();</div><div class="line">        &#125;catch(Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><br><br><br></p>
<p>2.爬取CSDN的博客【2.0版】<br>—————————-·</p>
<ul>
<li>数据库连接采用单例链接，节约系统资源</li>
<li>添加WebMagic的爬虫监控，可用Java工具jconsole监控CSDN_Processor线程</li>
<li>重新设计数据库表结构【分为三个表，对应三个JavaBean】</li>
<li>优化Processor,正则XPATH，代码分层，有注释便于以后回顾</li>
<li>UseDB.java添加单例模式</li>
<li>使用Redius对爬取的URL进行管理，每次开始程序就会从上次爬取的地方进行爬取,需要启动Redis</li>
<li>终止程序后,下次爬取会自动从Redis上次爬取的URL开始爬取【暂停功能，重新启动】</li>
<li>使用WebMagic的框架的Redis无法实现去重【在数据库设置了num主键自增,爬取重复页面时处理相同，仍然会执行插入操作,虽然会失败，但是会自增】，未解决！！！！</li>
</ul>
<p><br><br></p>
<p>A.设计数据表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">1.用户资料表</div><div class="line">    编号【统计数量,主键自增】</div><div class="line">    id【非空,唯一】</div><div class="line">    昵称</div><div class="line">    简介</div><div class="line">    个性签名【有些博主的签名相当长啊】</div><div class="line">    关注</div><div class="line">    粉丝</div><div class="line"></div><div class="line">CREATE TABLE blogger_csdn(             </div><div class="line">    num INT auto_increment primary key,</div><div class="line">    id VARCHAR(50) NOT NULL unique,</div><div class="line">    b_nickname VARCHAR(50),</div><div class="line">    b_intro VARCHAR(500),</div><div class="line">    b_sign VARCHAR(2000),</div><div class="line">    b_focus INT,</div><div class="line">    b_fans INT</div><div class="line">)ENGINE = innoDB;</div><div class="line"></div><div class="line"></div><div class="line">***********************</div><div class="line"></div><div class="line">2.用户博文列表页</div><div class="line">    编号【统计数量,主键自增】</div><div class="line">    id【非空,唯一】</div><div class="line">    访问次数</div><div class="line">    积分</div><div class="line">    排名【某些人排名是千里之外】</div><div class="line">    包含博文属性</div><div class="line">    包含博文类型</div><div class="line">CREATE TABLE bloglist_csdn(             </div><div class="line">    num INT auto_increment primary key,</div><div class="line">    id VARCHAR(50) NOT NULL unique,</div><div class="line">    bl_visittimes INT,</div><div class="line">    bl_score INT,</div><div class="line">    bl_rank VARCHAR(10),</div><div class="line">    bl_blognature VARCHAR(50),</div><div class="line">    bl_blogtype VARCHAR(2000)</div><div class="line">)ENGINE = innoDB;</div><div class="line"></div><div class="line"></div><div class="line">***********************</div><div class="line"></div><div class="line"></div><div class="line">3.博文页</div><div class="line">    编号【统计数量,主键自增】</div><div class="line">    标题</div><div class="line">    URL【非空,唯一】</div><div class="line">    阅读数</div><div class="line">    评论数</div><div class="line">    文章类型</div><div class="line">    发表时间</div><div class="line">    博主id【非空】</div><div class="line">CREATE TABLE blogarticle_csdn(             </div><div class="line">    num INT auto_increment primary key,</div><div class="line">    ba_title VARCHAR(200),</div><div class="line">    ba_url VARCHAR(500) NOT NULL unique,</div><div class="line">    ba_readtimes INT,</div><div class="line">    ba_commenttimes INT,</div><div class="line">    ba_articletype VARCHAR(50),</div><div class="line">    ba_publishdate VARCHAR(20),</div><div class="line">    ba_bloggerid VARCHAR(50) NOT NULL</div><div class="line">)ENGINE = innoDB;</div></pre></td></tr></table></figure></p>
<hr>
<p><br><br></p>
<p>2.三种JavaBean<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div></pre></td><td class="code"><pre><div class="line">package bean;</div><div class="line"></div><div class="line">//CSND-用户资料表</div><div class="line">public class CSDN_bloggerBean &#123;</div><div class="line">    </div><div class="line">        private String id;                          //【id】</div><div class="line">        private String b_nickname;          //【昵称】</div><div class="line">        private String b_intro;                 //【简介】</div><div class="line">        private String b_sign;                  //【签名】</div><div class="line">        private int b_focus;                        //【关注】</div><div class="line">        private int b_fans;                     //【粉丝】</div><div class="line">        </div><div class="line">        public String getId() &#123;</div><div class="line">            return id;</div><div class="line">        &#125;</div><div class="line">        public String getB_nickname() &#123;</div><div class="line">            return b_nickname;</div><div class="line">        &#125;</div><div class="line">        public String getB_intro() &#123;</div><div class="line">            return b_intro;</div><div class="line">        &#125;</div><div class="line">        public String getB_sign() &#123;</div><div class="line">            return b_sign;</div><div class="line">        &#125;</div><div class="line">        public int getB_focus() &#123;</div><div class="line">            return b_focus;</div><div class="line">        &#125;</div><div class="line">        public int getB_fans() &#123;</div><div class="line">            return b_fans;</div><div class="line">        &#125;</div><div class="line">        public void setId(String id) &#123;</div><div class="line">            this.id = id;</div><div class="line">        &#125;</div><div class="line">        public void setB_nickname(String b_nickname) &#123;</div><div class="line">            this.b_nickname = b_nickname;</div><div class="line">        &#125;</div><div class="line">        public void setB_intro(String b_intro) &#123;</div><div class="line">            this.b_intro = b_intro;</div><div class="line">        &#125;</div><div class="line">        public void setB_sign(String b_sign) &#123;</div><div class="line">            this.b_sign = b_sign;</div><div class="line">        &#125;</div><div class="line">        public void setB_focus(int b_focus) &#123;</div><div class="line">            this.b_focus = b_focus;</div><div class="line">        &#125;</div><div class="line">        public void setB_fans(int b_fans) &#123;</div><div class="line">            this.b_fans = b_fans;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">***************************************************</div><div class="line"></div><div class="line">package bean;</div><div class="line"></div><div class="line">//CSDN-用户博文列表</div><div class="line">public class CSDN_bloglistBean &#123;</div><div class="line">    </div><div class="line">    private String id;                          //【id】</div><div class="line">    private int bl_visitTimes;              //【访问次数】</div><div class="line">    private int bl_score;                   //【积分】</div><div class="line">    private String bl_rank;                     //【排名】</div><div class="line">    private String bl_blogNature;       //【包含博文属性】</div><div class="line">    private String bl_blogType;         //【包含博文类型】</div><div class="line">    </div><div class="line">    public String getId() &#123;</div><div class="line">        return id;</div><div class="line">    &#125;</div><div class="line">    public int getBl_visitTimes() &#123;</div><div class="line">        return bl_visitTimes;</div><div class="line">    &#125;</div><div class="line">    public int getBl_score() &#123;</div><div class="line">        return bl_score;</div><div class="line">    &#125;</div><div class="line">    public String getBl_rank() &#123;</div><div class="line">        return bl_rank;</div><div class="line">    &#125;</div><div class="line">    public String getBl_blogNature() &#123;</div><div class="line">        return bl_blogNature;</div><div class="line">    &#125;</div><div class="line">    public String getBl_blogType() &#123;</div><div class="line">        return bl_blogType;</div><div class="line">    &#125;</div><div class="line">    public void setId(String id) &#123;</div><div class="line">        this.id = id;</div><div class="line">    &#125;</div><div class="line">    public void setBl_visitTimes(int bl_visitTimes) &#123;</div><div class="line">        this.bl_visitTimes = bl_visitTimes;</div><div class="line">    &#125;</div><div class="line">    public void setBl_score(int bl_score) &#123;</div><div class="line">        this.bl_score = bl_score;</div><div class="line">    &#125;</div><div class="line">    public void setBl_rank(String bl_rank) &#123;</div><div class="line">        this.bl_rank = bl_rank;</div><div class="line">    &#125;</div><div class="line">    public void setBl_blogNature(String bl_blogNature) &#123;</div><div class="line">        this.bl_blogNature = bl_blogNature;</div><div class="line">    &#125;</div><div class="line">    public void setBl_blogType(String bl_blogType) &#123;</div><div class="line">        this.bl_blogType = bl_blogType;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">***************************************************</div><div class="line"></div><div class="line">package bean;</div><div class="line"></div><div class="line">//CSDN-博文页</div><div class="line">public class CSDN_blogarticleBean &#123;</div><div class="line">    </div><div class="line">    private String ba_title;                        //【标题】</div><div class="line">    private String ba_URL;                  //【URL地址】</div><div class="line">    private int ba_readTimes;               //【阅读数】</div><div class="line">    private int ba_commentTimes;        //【评论数】</div><div class="line">    private String ba_articleType;          //【文章类型】</div><div class="line">    private String ba_publishDate;      //【发表时间】</div><div class="line">    private String ba_bloggerId;            //【博主id】</div><div class="line">    </div><div class="line">    </div><div class="line">    public String getBa_title() &#123;</div><div class="line">        return ba_title;</div><div class="line">    &#125;</div><div class="line">    public String getBa_URL() &#123;</div><div class="line">        return ba_URL;</div><div class="line">    &#125;</div><div class="line">    public int getBa_readTimes() &#123;</div><div class="line">        return ba_readTimes;</div><div class="line">    &#125;</div><div class="line">    public int getBa_commentTimes() &#123;</div><div class="line">        return ba_commentTimes;</div><div class="line">    &#125;</div><div class="line">    public String getBa_articleType() &#123;</div><div class="line">        return ba_articleType;</div><div class="line">    &#125;</div><div class="line">    public String getBa_publishDate() &#123;</div><div class="line">        return ba_publishDate;</div><div class="line">    &#125;</div><div class="line">    public String getBa_bloggerId() &#123;</div><div class="line">        return ba_bloggerId;</div><div class="line">    &#125;</div><div class="line">    public void setBa_title(String ba_title) &#123;</div><div class="line">        this.ba_title = ba_title;</div><div class="line">    &#125;</div><div class="line">    public void setBa_URL(String ba_URL) &#123;</div><div class="line">        this.ba_URL = ba_URL;</div><div class="line">    &#125;</div><div class="line">    public void setBa_readTimes(int ba_readTimes) &#123;</div><div class="line">        this.ba_readTimes = ba_readTimes;</div><div class="line">    &#125;</div><div class="line">    public void setBa_commentTimes(int ba_commentTimes) &#123;</div><div class="line">        this.ba_commentTimes = ba_commentTimes;</div><div class="line">    &#125;</div><div class="line">    public void setBa_articleType(String ba_articleType) &#123;</div><div class="line">        this.ba_articleType = ba_articleType;</div><div class="line">    &#125;</div><div class="line">    public void setBa_publishDate(String ba_publishDate) &#123;</div><div class="line">        this.ba_publishDate = ba_publishDate;</div><div class="line">    &#125;</div><div class="line">    public void setBa_bloggerId(String ba_bloggerId) &#123;</div><div class="line">        this.ba_bloggerId = ba_bloggerId;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><br><br></p>
<p>C.Processor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div></pre></td><td class="code"><pre><div class="line">package PageProcessor;</div><div class="line"></div><div class="line">import java.util.ArrayList;</div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import Pipeline.CSDN_Pipeline2;</div><div class="line">import bean.CSDN_blogarticleBean;</div><div class="line">import bean.CSDN_bloggerBean;</div><div class="line">import bean.CSDN_bloglistBean;</div><div class="line">import us.codecraft.webmagic.Page;</div><div class="line">import us.codecraft.webmagic.Site;</div><div class="line">import us.codecraft.webmagic.Spider;</div><div class="line">import us.codecraft.webmagic.processor.PageProcessor;</div><div class="line">import us.codecraft.webmagic.scheduler.RedisScheduler;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">public class CSDN_Processor2 implements PageProcessor&#123;</div><div class="line"></div><div class="line">    //正则列表</div><div class="line">    private static final String blogger=&quot;http://my.csdn.net/\\w+&quot;;                                                  //用户资料页</div><div class="line">    private static final String blog_LIST=&quot;http://blog.csdn.net/(.*)/article/list/\\d+&quot;;                //用户博文列表页</div><div class="line">    private static final String blog_ARTICLE=&quot;http://blog.csdn.net/(.*)/article/details/\\d+&quot;;      //博文页</div><div class="line">    </div><div class="line">    private static  long beginTime=System.currentTimeMillis();//统计开始爬取的时间</div><div class="line">    </div><div class="line">    private static int userCount=0;</div><div class="line">    </div><div class="line">    // 抓取网站的相关配置，包括编码、抓取间隔、重试次数等</div><div class="line">    private Site site = Site.me().setCharset(&quot;utf-8&quot;).setSleepTime(1/1000).setRetryTimes(5);</div><div class="line"></div><div class="line">    </div><div class="line">    public Site getSite() &#123;</div><div class="line">        return site;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    public void process(Page page)&#123;</div><div class="line">             //标识：1-用户资料页,2-用户博文列表页,2-博文页</div><div class="line">             int mark =0;</div><div class="line">        </div><div class="line"></div><div class="line">             if(page.getUrl().regex(blogger).match())&#123;</div><div class="line">                 //A.用户资料页</div><div class="line">                 </div><div class="line">                 //A-1获取该用户数据</div><div class="line">                 mark=1;</div><div class="line">                 String id=page.getUrl().get().substring(page.getUrl().get().lastIndexOf(&quot;/&quot;)+1);</div><div class="line">                 String b_nickname=page.getHtml().xpath(&quot;//dt[@class=&apos;person-nick-name&apos;]/allText()&quot;).get();</div><div class="line">                 String b_intro=page.getHtml().xpath(&quot;//dd[@class=&apos;person-detail&apos;]/allText()&quot;).get();</div><div class="line">                 String b_sign = page.getHtml().xpath(&quot;//dd[@class=&apos;person-sign&apos;]/allText()&quot;).get().replace(&quot;,&quot;, &quot;，&quot;).replace(&quot;&apos;&quot;, &quot;‘&quot;).replace(&quot;没有内容可显示&quot;,&quot;&quot;);</div><div class="line">                 String b_focus=page.getHtml().xpath(&quot;//dd[@class=&apos;focus_num&apos;]/b/allText()&quot;).get().replace(&quot;未显示简介&quot;,&quot;&quot;);</div><div class="line">                 String b_fans =page.getHtml().xpath(&quot;//dd[@class=&apos;fans_num&apos;]/b/allText()&quot;).get();</div><div class="line">                 CSDN_bloggerBean bean  = new CSDN_bloggerBean();</div><div class="line">                        bean.setId(id);                                                 //【用户id】            </div><div class="line">                        bean.setB_nickname(b_nickname);                 //【昵称】</div><div class="line">                        bean.setB_intro(b_intro);                                   //【简介】</div><div class="line">                        bean.setB_sign(b_sign);                                 //【签名】</div><div class="line">                        bean.setB_focus(Integer.valueOf(b_focus));      //【关注】</div><div class="line">                        bean.setB_fans(Integer.valueOf(b_fans));            //【粉丝】      </div><div class="line">                 System.out.println((++userCount)+&quot;号用户---------&gt;id:&quot;+id+&quot;\t\t昵称:&quot;+b_nickname+&quot;\t\t简介:&quot;+b_intro+&quot;\t\t签名:&quot;+b_sign+&quot;\t\t关注:&quot;+b_focus+&quot;\t\t粉丝:&quot;+b_fans);</div><div class="line">                </div><div class="line">                 page.putField(&quot;mark&quot;, mark);</div><div class="line">                 page.putField(&quot;CSDN_bloggerBean&quot;, bean);</div><div class="line">                        </div><div class="line">                //A-2.生成该用户的博客列表页链接</div><div class="line">                 page.addTargetRequest(&quot;http://blog.csdn.net/&quot;+id+&quot;/article/list/1&quot;);</div><div class="line"></div><div class="line">                //A-3.获取其余用户的链接</div><div class="line">                List&lt;String&gt; otherBlogger_list=page.getHtml().xpath(&quot;//div[@class=&apos;mod_relations&apos;]//a&quot;).links().regex(blogger).all();</div><div class="line">                page.addTargetRequests(otherBlogger_list);</div><div class="line">                </div><div class="line"></div><div class="line">             &#125;</div><div class="line">             else if(page.getUrl().regex(blog_LIST).match())&#123;</div><div class="line">                 //B.用户博文列表页</div><div class="line">                 </div><div class="line">                    //只在第1页获取资料</div><div class="line">                    if( page.getUrl().regex(&quot;(.*)/list/1&quot;).match())&#123;            </div><div class="line">                            mark=2;</div><div class="line">                            </div><div class="line">                            //B-1.获取用户的资料</div><div class="line">                            String id=page.getHtml().xpath(&quot;//div[@id=&apos;blog_userface&apos;]/span[1]/allText()&quot;).get();</div><div class="line">                            String bl_visitTimes =page.getHtml().xpath(&quot;//ul[@id=&apos;blog_rank&apos;]/li[1]/span[1]/allText()&quot;).get().replace(&quot;次&quot;,&quot;&quot;);</div><div class="line">                            String bl_score = page.getHtml().xpath(&quot;//ul[@id=&apos;blog_rank&apos;]/li[2]/span/allText()&quot;).get();</div><div class="line">                            String bl_rank =page.getHtml().xpath(&quot;//ul[@id=&apos;blog_rank&apos;]/li[4]/span/allText()&quot;).get().replace(&quot;第&quot;,&quot;&quot;).replace(&quot;名&quot;,&quot;&quot;);</div><div class="line">                            String bl_blogNature=page.getHtml().xpath(&quot;//ul[@id=&apos;blog_statistics&apos;]/allText()&quot;).get().replace(&quot;：&quot;,&quot;(&quot;).replace(&quot;篇 &quot;,&quot;)-&quot;)+&quot;)&quot;;</div><div class="line">                            String bl_blogType=page.getHtml().xpath(&quot;//div[@id=&apos;panel_Category&apos;]/ul[2]/allText()&quot;).get().replace(&quot; &quot;,&quot;-&quot;).replace(&quot;,&quot;, &quot;，&quot;).replace(&quot;&apos;&quot;, &quot;‘&quot;);      </div><div class="line">                            CSDN_bloglistBean bean =new CSDN_bloglistBean();</div><div class="line">                                    bean.setId(id);                                                                     //【用户id】</div><div class="line">                                    bean.setBl_visitTimes(Integer.parseInt(bl_visitTimes));         //【访问次数】</div><div class="line">                                    bean.setBl_score(Integer.parseInt(bl_score));                       //【积分】</div><div class="line">                                    bean.setBl_rank(bl_rank);                                                       //【排名】</div><div class="line">                                    bean.setBl_blogNature(bl_blogNature);                               //【包含博文博文属性】</div><div class="line">                                    bean.setBl_blogType(bl_blogType);                                       //【包含博文类型】</div><div class="line">                                    System.out.println(&quot;列表页==&gt;用户id:&quot;+id+&quot;\t\t访问次数:&quot;+bl_visitTimes+&quot;\t\t积分:&quot;+bl_score+&quot;\t\t排名:&quot;+bl_rank+&quot;\t\t博客统计:&quot;+bl_blogNature+&quot;\t\t文章分类:&quot;+bl_blogType);</div><div class="line">                            </div><div class="line">                            page.putField(&quot;mark&quot;, mark);</div><div class="line">                            page.putField(&quot;CSDN_bloglistBean&quot;, bean);</div><div class="line">                            </div><div class="line">                            //B-2.获取总页数【生成该用户所有页的链接】</div><div class="line">                            String pageS =page.getHtml().xpath(&quot;//div[@id=&apos;papelist&apos;]/span[1]/allText()&quot;).get(); //获取总页数</div><div class="line">                            int pageCount =Integer.parseInt(pageS.substring(pageS.lastIndexOf(&quot;共&quot;)+1,pageS.lastIndexOf(&quot;页&quot;)));</div><div class="line">                            List&lt;String&gt; page_list=new ArrayList&lt;String&gt;();</div><div class="line">                            for(int p=2;p&lt;=pageCount;p++)&#123;      //生成URL【跳进来的时候就是第1页了，所以从第2页开始】</div><div class="line">                                page_list.add(&quot;http://blog.csdn.net/&quot;+id+&quot;/article/list/&quot;+p);</div><div class="line">                            &#125;</div><div class="line">                            page.addTargetRequests(page_list);</div><div class="line">                    &#125;</div><div class="line">                 </div><div class="line">                    </div><div class="line">                    //获取当前页所有博文链接</div><div class="line">                    List&lt;String&gt; blogArticle_list=page.getHtml().xpath(&quot;//span[@class=&apos;link_title&apos;]/a[1]/@href&quot;).all();</div><div class="line">                    page.addTargetRequests(blogArticle_list);</div><div class="line"></div><div class="line">                    </div><div class="line">             &#125;else if(page.getUrl().regex(blog_ARTICLE).match())&#123;</div><div class="line">                 //C.博文页</div><div class="line">                 mark=3;</div><div class="line"></div><div class="line">                 //C-1获取博文资料</div><div class="line">                 String ba_title=page.getHtml().xpath(&quot;//h1/allText()&quot;).get().replace(&quot;,&quot;, &quot;，&quot;).replace(&quot;&apos;&quot;, &quot;‘&quot;);</div><div class="line">                 String ba_URL=page.getUrl().get();</div><div class="line">                 String ba_readTimes=page.getHtml().xpath(&quot;//div[@class=&apos;article_r&apos;]/span[2]/allText()&quot;).get().replace(&quot;人阅读&quot;,&quot;&quot;);</div><div class="line">                 String ba_commentTimes=page.getHtml().xpath(&quot;//div[@class=&apos;article_r&apos;]/span[3]/allText()&quot;).get().replace(&quot;评论(&quot;,&quot;&quot;).replace(&quot;)&quot;,&quot;&quot;);    </div><div class="line">                 String ba_articleType=&quot;无&quot;;</div><div class="line">                 if(page.getHtml().xpath(&quot;//div[@class=&apos;category_r&apos;]&quot;).get()!= null)&#123;  //若类型不为空</div><div class="line">                     ba_articleType=page.getHtml().xpath(&quot;//div[@class=&apos;category_r&apos;]//span[1]/allText()&quot;).get().replace(&quot;,&quot;, &quot;，&quot;).replace(&quot;&apos;&quot;, &quot;‘&quot;).replaceAll(&quot;\\（.*\\）&quot;, &quot;&quot;);//正则去除（内字符）</div><div class="line">                 &#125;</div><div class="line">                 String ba_publishDate=page.getHtml().xpath(&quot;//div[@class=&apos;article_r&apos;]//span[1]/allText()&quot;).get();</div><div class="line">                 String ba_bloggerId=page.getUrl().get().substring(page.getUrl().get().indexOf(&quot;net/&quot;)+4,page.getUrl().get().lastIndexOf(&quot;/article&quot;));</div><div class="line">                 CSDN_blogarticleBean bean = new CSDN_blogarticleBean();</div><div class="line">                        bean.setBa_title(ba_title);                                                                     //【标题】</div><div class="line">                        bean.setBa_URL(ba_URL);                                                                 //【博文URL】</div><div class="line">                        bean.setBa_readTimes(Integer.parseInt(ba_readTimes));                       //【阅读数】</div><div class="line">                        bean.setBa_commentTimes(Integer.parseInt(ba_commentTimes));     //【评论数】</div><div class="line">                        bean.setBa_articleType(ba_articleType);                                             //【文章类型】</div><div class="line">                        bean.setBa_publishDate(ba_publishDate);                                         //【发表时间】</div><div class="line">                        bean.setBa_bloggerId(ba_bloggerId);                                                 //【博主id】</div><div class="line">                 System.out.println(&quot;标题:&quot;+ba_title+&quot;\t内容URL:&quot;+ba_URL+&quot;\t\t阅读数:&quot;+ba_readTimes+&quot;\t\t评论:&quot;+ba_commentTimes+&quot;\t\t文章类型:&quot;+ba_articleType+&quot;\t\t发表时间:&quot;+ba_publishDate+&quot;\t\t博主id:&quot;+ba_bloggerId);</div><div class="line">                    </div><div class="line">                    page.putField(&quot;mark&quot;, mark);</div><div class="line">                    page.putField(&quot;CSDN_blogarticleBean&quot;, bean);</div><div class="line">             &#125;</div><div class="line">            else&#123;  //其他页面直接过滤，不执行Pipeline</div><div class="line">                 page.setSkip(true);</div><div class="line">             &#125;</div><div class="line">             </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    public static void main(String [] args)&#123;</div><div class="line">        try&#123;</div><div class="line">            </div><div class="line">            //CSDN任意一个用户的个人资料页面作为入口【这里选得是2016.12.13官网右边的某个签约作者】</div><div class="line">            //QueueScheduler【使用内存队列保存待抓取URL】，使用BloomFilterDuplicateRemove去重</div><div class="line">            //FileCacheQueueScheduler使用文件保存抓取URL，可以在关闭程序并下次启动时，从之前抓取到的URL继续抓取需指定路径，会建立.urls.txt和.cursor.txt两个文件</div><div class="line">            //使用Redis对抓取的URL进行管理【未实现】</div><div class="line">            //添加Pipeline,对数据进行处理每个Page如果skip为true，都会执行CSDN_Pipeline的process()</div><div class="line">            //开启10个线程进爬取</div><div class="line">            </div><div class="line">                Spider.create(new CSDN_Processor2()).addUrl(&quot;http://my.csdn.net/lfdfhl&quot;)    </div><div class="line">//                  .scheduler(new QueueScheduler().setDuplicateRemover(new BloomFilterDuplicateRemover(10000000)))</div><div class="line">//                  .scheduler(new FileCacheQueueScheduler(&quot;E:\\javaweb_WorkSpace\\Webmagic\\savaURLFile&quot;))</div><div class="line">                    .scheduler(new RedisScheduler(&quot;127.0.0.1&quot;))          //需要开启Redis,填写主机IP</div><div class="line">                    .addPipeline(new CSDN_Pipeline2())</div><div class="line">                    .thread(10)</div><div class="line">                    .run();</div><div class="line">            </div><div class="line">            //爬虫监控【开始爬取之后,DOS输入jconsole选择CSDN_Processor2进程进行监控】</div><div class="line">//          SpiderMonitor.instance().register(task);</div><div class="line">//          task.start();</div><div class="line">        </div><div class="line">        </div><div class="line">        System.out.println(&quot;爬取完毕,总共耗时:&quot;+(String.valueOf(((double)System.currentTimeMillis()-beginTime)/1000))+&quot;秒.&quot;);</div><div class="line">        &#125;catch(Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><br><br></p>
<p>Pipeline<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line">package Pipeline;</div><div class="line"></div><div class="line">import java.util.List;</div><div class="line"></div><div class="line">import Utils.UseDB;</div><div class="line">import bean.CSDN_blogarticleBean;</div><div class="line">import bean.CSDN_bloggerBean;</div><div class="line">import bean.CSDN_bloglistBean;</div><div class="line">import us.codecraft.webmagic.ResultItems;</div><div class="line">import us.codecraft.webmagic.Task;</div><div class="line">import us.codecraft.webmagic.pipeline.ConsolePipeline;</div><div class="line"></div><div class="line">public class CSDN_Pipeline2 extends ConsolePipeline  &#123;</div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">     // ResultItems保存了抽取结果，它是一个Map结构，</div><div class="line">    // 在page.putField(key,value)中保存的数据，可以通过ResultItems.get(key)获取</div><div class="line">    public void process(ResultItems resultItems, Task arg1) &#123;</div><div class="line">        </div><div class="line">        //获取标识【判断是那种类型页面】</div><div class="line">        int mark =resultItems.get(&quot;mark&quot;);</div><div class="line">        </div><div class="line">        try&#123;</div><div class="line">            UseDB udb =UseDB.getInstance(&quot;javareptile&quot;); //单例模式获取实例</div><div class="line">//          UseDB udb =new UseDB();</div><div class="line">//          udb.connDatabase(&quot;javareptile&quot;);</div><div class="line"></div><div class="line">            //根据不同的mark，处理来自不同页面的数据</div><div class="line">            if(mark==1)&#123;</div><div class="line">                //A.用户资料页</div><div class="line">                CSDN_bloggerBean bean1=(CSDN_bloggerBean)resultItems.get(&quot;CSDN_bloggerBean&quot;);</div><div class="line">                udb.insertReplace(&quot;blogger_csdn&quot;, </div><div class="line">                        &quot;id,b_nickname,b_intro,b_sign,b_focus,b_fans&quot;, </div><div class="line">                        &quot;&apos;&quot;+    bean1.getId()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean1.getB_nickname()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean1.getB_intro()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean1.getB_sign()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean1.getB_focus()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean1.getB_fans()+&quot;&apos;&quot;);</div><div class="line">            </div><div class="line">            &#125;else if(mark==2)&#123;</div><div class="line">                //B.用户博文列表页</div><div class="line">                CSDN_bloglistBean bean2=(CSDN_bloglistBean)resultItems.get(&quot;CSDN_bloglistBean&quot;);</div><div class="line">                    udb.insertReplace(&quot;bloglist_csdn&quot;, </div><div class="line">                            &quot;id,bl_visittimes,bl_score,bl_rank,bl_blognature,bl_blogtype&quot;, </div><div class="line">                            &quot;&apos;&quot;+    bean2.getId()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                    bean2.getBl_visitTimes()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                    bean2.getBl_score()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                    bean2.getBl_rank()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                    bean2.getBl_blogNature()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                    bean2.getBl_blogType()+&quot;&apos;&quot;);</div><div class="line"></div><div class="line">            &#125;else if(mark==3)&#123;</div><div class="line">                //C.博文页</div><div class="line">                CSDN_blogarticleBean bean3=(CSDN_blogarticleBean)resultItems.get(&quot;CSDN_blogarticleBean&quot;);</div><div class="line">                udb.insertReplace(&quot;blogarticle_csdn&quot;, </div><div class="line">                        &quot;ba_title,ba_url,ba_readtimes,ba_commenttimes,ba_articletype,ba_publishdate,ba_bloggerid&quot;, </div><div class="line">                        &quot;&apos;&quot;+    bean3.getBa_title()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_URL()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_readTimes()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_commentTimes()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_articleType()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_publishDate()+&quot;&apos;,&apos;&quot;+</div><div class="line">                                bean3.getBa_bloggerId()+&quot;&apos;&quot;);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            //关闭数据库连接</div><div class="line">//          udb.closeAll();</div><div class="line">            </div><div class="line">        &#125;catch(Exception e)&#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MyProject/" rel="tag"># MyProject</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/05/Bat_批处理脚本/" rel="next" title="Bat_批处理脚本">
                <i class="fa fa-chevron-left"></i> Bat_批处理脚本
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/08/Git_参考资料与基础操作/" rel="prev" title="Git_资源汇总">
                Git_资源汇总 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/suvan.png"
               alt="liushuwei" />
          <p class="site-author-name" itemprop="name">liushuwei</p>
           
              <p class="site-description motion-element" itemprop="description">Suvan的博客</p>
          
        </div>
        <nav class="site-state motion-element">
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">58</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Suvan-L" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="liushuwei0925@gmail.com" target="_blank" title="Gmail">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  Gmail
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="526097449" target="_blank" title="QQ">
                  
                    <i class="fa fa-fw fa-qq"></i>
                  
                  QQ
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#一-环境"><span class="nav-number">2.</span> <span class="nav-text">一.环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二-项目结构"><span class="nav-number">3.</span> <span class="nav-text">二.项目结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三-代码："><span class="nav-number">4.</span> <span class="nav-text">三.代码：</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-爬取CSDN的博客【1-0版本】"><span class="nav-number">4.1.</span> <span class="nav-text">1.爬取CSDN的博客【1.0版本】</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script> <!--博客量统计-->
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">liushuwei</span>
</div>


<div class="powered-by">
   
  <!--
    由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
    -->
</div>

<div class="theme-info">
	高调做事,低调做人

  <!-- 主题
    主题 -
    <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
      NexT.Mist
    </a>
  -->
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
